# Linux 内核架构阅读笔记

## 1. 概念篇：

### 1.1 内核的任务

​	内核是硬件与软件之间的中间层，作用是将应用程序的请求传递给硬件，并充当底层驱动程序，对系统中的各种设备和组件进行寻址

### 1.2 实现策略

- 微内核

  最基本功能直接由中央内核（微内核）实现，其他功能委托独立进程，进程通过明确定义的通信接口与中心内核通信

- 宏内核

  内核的全部代码都打包到一个文件中，内核中的每个函数都可以访问内核中其他部分

### 1.3 内核的组成部分

- 进程切换

  通过在撤销进程CPU资源前保存进程状态，并将进程置于空闲状态，在重新激活进程时，将保存状态恢复

- 进程调度

  重要进程得到CPU时间多一点，次要进程少一点

- UNIX进程

  Linux进程采用层次系统，每个进程都依赖于一个父进程。内核启动init程序作为第一个进程，因此init时进程根，所有进程都直接或间接起源自该进程（pstree命令输出进程树）

- 创建新进程机制

  - fork（创建当前进程的副本，父进程和子进程只有PID不同）

  - exec（将一个新程序加载到当前进程的内存中并执行）

- 线程与进程

  本质上进程可能由若干线程组成，这些线程共享相同的数据和资源，但可能执行程序中不同的代码路径；

  Linux用clone方法创建线程

由于内存区域是通过指针寻址，因此CPU的字长决定了所能管理的地址空间的最大长度

地址空间的最大长度与实际可用的物理内存数量无关，因此被称为虚拟地址空间

虚拟地址空间：内核空间、用户空间

- 页表

  用来将虚拟地址空间映射到物理地址空间的数据结构

- 伙伴系统和slab缓存

  页帧的分配由伙伴系统进行，而slab分配器则负责分配小内存以及提供一般性的内核缓存

- 页面交换和页面回收

  页面交换通过利用磁盘空间作为扩展内存，从而增大了可用的内存；页面回收用于将内存映射被修改的内容与底层的块设备同步，为此有时也简称为数据回写

- 系统调用

  系统调用是用户进程与内核交互的经典方法

  进程管理：创建新进程，查询信息，调试

  信号：发送信号，定时器以及相关处理机制

  文件：创建、打开和关闭文件，从文件读取和向文件写入，查询信息和状态

  目录和文件系统：创建、删除和重命名目录，查询信息，链接，变更目录

  保护机制：读取和变更UID/GID，命名空间的处理

  定时器函数：定时器函数和统计信息

  用户进程要从用户状态切换到核心态，并将系统关键任务委派给内核执行，系统调用是必由之路

- 设备驱动程序、块设备和字符设备

  设备驱动程序用于与系统连接的输入/输出装置通信，设备驱动程序的任务在于支持应用程序经由设备文件与设备通信

  字符设备：通过连续的数据流，应用程序可以顺序读取，通常不支持随机存取

  块设备：应用程序可以随机访问设备数据，程序可自行确定读取数据的位置

  







